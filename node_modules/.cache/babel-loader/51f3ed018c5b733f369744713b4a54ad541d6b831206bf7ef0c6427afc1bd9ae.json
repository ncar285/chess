{"ast":null,"code":"import jwtFetch from './jwt';\nimport { RECEIVE_MEAL_PLAN, RECEIVE_USER_NUTRITION, REMOVE_USER_NUTRITION, receiveUserNutrition } from './foods';\nimport { receiveErrors } from './session';\nimport { RECEIVE_USER_LOGOUT } from './session';\nimport { RECEIVE_CURRENT_USER } from './session';\nimport moment from 'moment-timezone';\nimport { RECEIVE_WORKOUT, RECEIVE_WORKOUTS } from './workouts';\n\n// CONSTANTS \n\nconst RECEIVE_USER_HEALTH = 'users/RECEIVE_USER_HEALTH';\nconst RECEIVE_WEIGHT_BY_DATE = 'users/RECEIVE_WEIGHT_BY_DATE';\n\n// ACTION CREATORS\n\nexport const receiveUserHealth = healthData => ({\n  type: RECEIVE_USER_HEALTH,\n  healthData\n});\nexport const receiveWeightByDate = (weight, date) => ({\n  type: RECEIVE_WEIGHT_BY_DATE,\n  weight,\n  date\n});\n\n// SELECTORS\n\nexport const getUserNutritionByDay = state => {\n  const nutritionItems = Object.values(state.users.nutritionItems);\n  const dailyNutrition = nutritionItems.filter(nutritionItem => {\n    const dateConsumed = new moment.utc(nutritionItem.dateConsumed).format(\"YYYY-MM-DD\");\n    return dateConsumed === state.ui.selectedDate;\n  });\n  return dailyNutrition;\n};\nexport const getUserWeightByDate = state => state.users.weightByDate;\n\n// THUNK ACTION CREATORS\n\nexport const updateUser = updatedUser => async dispatch => {\n  try {\n    const res = await jwtFetch(`api/users/${updatedUser._id}`, {\n      method: \"PATCH\",\n      body: JSON.stringify(updatedUser)\n    });\n    const user = await res.json();\n  } catch (err) {\n    const res = await err.json();\n    return dispatch(receiveErrors(res.errors));\n  }\n};\nexport const fetchUserNutritionByDay = selectedDate => async dispatch => {\n  try {\n    const res = await jwtFetch(`/api/nutrition/day?date=${selectedDate}`);\n    const dailyNutrition = await res.json();\n    dispatch(receiveUserNutrition({\n      nutrition: dailyNutrition\n    }));\n  } catch (err) {\n    const res = await err.json();\n    return dispatch(receiveErrors(res.errors));\n  }\n};\nexport const addWeightByDate = (weight, date) => async dispatch => {\n  try {\n    const res = await jwtFetch(`/api/users/weight`, {\n      method: \"POST\",\n      body: JSON.stringify({\n        weight,\n        date\n      })\n    });\n    if (res.ok) {\n      dispatch(receiveWeightByDate(weight, date));\n    } else {\n      const errorData = await res.json();\n      return dispatch(receiveErrors(errorData.errors));\n    }\n  } catch (err) {\n    const res = await err.json();\n    return dispatch(receiveErrors(res.errors));\n  }\n};\n\n// REDUCER\n\nconst initialState = {\n  nutritionItems: {},\n  workouts: [],\n  healthData: {},\n  mealPlan: {},\n  weightByDate: {}\n};\nconst usersReducer = (state = initialState, action) => {\n  var _action$currentUser, _action$currentUser2, _action$currentUser3, _action$currentUser4;\n  const nextState = {\n    ...state\n  };\n  switch (action.type) {\n    case RECEIVE_CURRENT_USER:\n      nextState.nutritionItems = (_action$currentUser = action.currentUser) !== null && _action$currentUser !== void 0 && _action$currentUser.nutritionData ? action.currentUser.nutritionData : {};\n      nextState.healthData = (_action$currentUser2 = action.currentUser) !== null && _action$currentUser2 !== void 0 && _action$currentUser2.healthData ? action.currentUser.healthData : {};\n      nextState.workouts = ((_action$currentUser3 = action.currentUser) === null || _action$currentUser3 === void 0 ? void 0 : _action$currentUser3.workouts) || [];\n      nextState.weightByDate = ((_action$currentUser4 = action.currentUser) === null || _action$currentUser4 === void 0 ? void 0 : _action$currentUser4.weightByDate) || {};\n      return nextState;\n    case RECEIVE_USER_NUTRITION:\n      nextState.nutritionItems = action.userNutrition.nutrition;\n      return nextState;\n    case REMOVE_USER_NUTRITION:\n      return {\n        ...state,\n        nutritionItems: state.nutritionItems.filter(item => item._id !== action.userNutritionId)\n      };\n    case RECEIVE_USER_HEALTH:\n      return {\n        ...state,\n        healthData: action.healthData\n      };\n    case RECEIVE_MEAL_PLAN:\n      return {\n        ...state,\n        mealPlan: action.mealPlan\n      };\n    case RECEIVE_WORKOUT:\n      const newWorkout = action.workout.workouts[action.workout.workouts.length - 1];\n      nextState.workouts.push(newWorkout);\n      return nextState;\n    case RECEIVE_WORKOUTS:\n      nextState.workouts = action.workouts;\n      return nextState;\n    case RECEIVE_WEIGHT_BY_DATE:\n      nextState.weightByDate[action.date] = action.weight;\n      return nextState;\n    case RECEIVE_USER_LOGOUT:\n      return initialState;\n    default:\n      return state;\n  }\n};\nexport default usersReducer;","map":{"version":3,"names":["jwtFetch","RECEIVE_MEAL_PLAN","RECEIVE_USER_NUTRITION","REMOVE_USER_NUTRITION","receiveUserNutrition","receiveErrors","RECEIVE_USER_LOGOUT","RECEIVE_CURRENT_USER","moment","RECEIVE_WORKOUT","RECEIVE_WORKOUTS","RECEIVE_USER_HEALTH","RECEIVE_WEIGHT_BY_DATE","receiveUserHealth","healthData","type","receiveWeightByDate","weight","date","getUserNutritionByDay","state","nutritionItems","Object","values","users","dailyNutrition","filter","nutritionItem","dateConsumed","utc","format","ui","selectedDate","getUserWeightByDate","weightByDate","updateUser","updatedUser","dispatch","res","_id","method","body","JSON","stringify","user","json","err","errors","fetchUserNutritionByDay","nutrition","addWeightByDate","ok","errorData","initialState","workouts","mealPlan","usersReducer","action","_action$currentUser","_action$currentUser2","_action$currentUser3","_action$currentUser4","nextState","currentUser","nutritionData","userNutrition","item","userNutritionId","newWorkout","workout","length","push"],"sources":["/Users/apple/Documents/test/frontend/src/store/users.js"],"sourcesContent":["import jwtFetch from './jwt';\nimport { RECEIVE_MEAL_PLAN, RECEIVE_USER_NUTRITION, REMOVE_USER_NUTRITION, receiveUserNutrition } from './foods';\nimport { receiveErrors } from './session';\nimport { RECEIVE_USER_LOGOUT } from './session';\nimport { RECEIVE_CURRENT_USER } from './session';\nimport moment from 'moment-timezone';\nimport { RECEIVE_WORKOUT, RECEIVE_WORKOUTS } from './workouts';\n\n// CONSTANTS \n\nconst RECEIVE_USER_HEALTH = 'users/RECEIVE_USER_HEALTH'\nconst RECEIVE_WEIGHT_BY_DATE = 'users/RECEIVE_WEIGHT_BY_DATE'\n\n// ACTION CREATORS\n\nexport const receiveUserHealth = healthData => ({\n    type: RECEIVE_USER_HEALTH,\n    healthData\n});\n\nexport const receiveWeightByDate = (weight, date) => ({\n    type: RECEIVE_WEIGHT_BY_DATE,\n    weight,\n    date\n});\n\n// SELECTORS\n\nexport const getUserNutritionByDay = state => {\n    const nutritionItems = Object.values(state.users.nutritionItems);\n\n    const dailyNutrition = nutritionItems.filter(nutritionItem => {\n        const dateConsumed = new moment.utc(nutritionItem.dateConsumed).format(\"YYYY-MM-DD\")\n        return dateConsumed === state.ui.selectedDate;\n    });\n\n    return dailyNutrition;\n}\n\nexport const getUserWeightByDate = state => state.users.weightByDate;\n\n// THUNK ACTION CREATORS\n\nexport const updateUser = updatedUser => async dispatch => {\n    try {  \n        const res = await jwtFetch(`api/users/${updatedUser._id}`, {\n            method: \"PATCH\",\n            body: JSON.stringify(updatedUser)\n        });\n        const user = await res.json();\n\n    } catch(err) {\n        const res = await err.json();\n        return dispatch(receiveErrors(res.errors));\n    }\n};\n\nexport const fetchUserNutritionByDay = selectedDate => async dispatch => {\n    try {\n        const res = await jwtFetch(`/api/nutrition/day?date=${selectedDate}`);\n        const dailyNutrition = await res.json();\n        dispatch(receiveUserNutrition({nutrition: dailyNutrition}));\n    } catch(err) {\n        const res = await err.json();\n        return dispatch(receiveErrors(res.errors));\n    }\n}\n\nexport const addWeightByDate = (weight, date) => async dispatch => {\n    try {\n        const res = await jwtFetch(`/api/users/weight`, {\n            method: \"POST\",\n            body: JSON.stringify({ weight, date })\n        });\n\n\n        if (res.ok) {\n            dispatch(receiveWeightByDate(weight, date));\n        } else {\n            const errorData = await res.json();\n            return dispatch(receiveErrors(errorData.errors));\n        }\n    } catch(err) {\n        const res = await err.json();\n        return dispatch(receiveErrors(res.errors));\n    }\n}\n\n// REDUCER\n\nconst initialState = {\n    nutritionItems: {},\n    workouts: [],\n    healthData: {},\n    mealPlan: {},\n    weightByDate: {}\n};\n\nconst usersReducer = (state = initialState, action) => {\n    const nextState = { ...state };\n    \n    switch (action.type) {\n        case RECEIVE_CURRENT_USER:\n            nextState.nutritionItems = action.currentUser?.nutritionData ? action.currentUser.nutritionData : {}\n            nextState.healthData = action.currentUser?.healthData ? action.currentUser.healthData : {}\n            nextState.workouts = action.currentUser?.workouts || []\n            nextState.weightByDate = action.currentUser?.weightByDate || {}\n            return nextState\n        case RECEIVE_USER_NUTRITION:\n            nextState.nutritionItems = action.userNutrition.nutrition\n            return nextState;\n        case REMOVE_USER_NUTRITION:\n            return {\n                ...state,\n                nutritionItems: state.nutritionItems.filter(item => item._id !== action.userNutritionId)\n            };\n        case RECEIVE_USER_HEALTH:\n            return { ...state, healthData: action.healthData };\n        case RECEIVE_MEAL_PLAN:\n            return { ...state, mealPlan: action.mealPlan };\n        case RECEIVE_WORKOUT:\n            const newWorkout = action.workout.workouts[action.workout.workouts.length - 1];\n            nextState.workouts.push(newWorkout);\n            return nextState\n        case RECEIVE_WORKOUTS:\n            nextState.workouts = action.workouts;\n            return nextState;\n        case RECEIVE_WEIGHT_BY_DATE:\n            nextState.weightByDate[action.date] = action.weight;\n            return nextState;\n        case RECEIVE_USER_LOGOUT:\n            return initialState;\n        default:\n            return state;\n    }\n};\n\nexport default usersReducer;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}